const utility=require("my-little-lodash/dist/type"),EventEmitter=require("event-emitter-object"),LocalStorageDriver=require("./drivers/localStorage"),MemoryDriver=require("./drivers/memory");function LocalStoragePro(a={}){EventEmitter.call(this,{}),this.drivers={},this.driver=null,this.window=a.hasOwnProperty("window")?a.window:"undefined"==typeof window?null:window,this.addDriver("memory",MemoryDriver),this.addDriver("localStorage",LocalStorageDriver)}LocalStoragePro.prototype=Object.create(EventEmitter.prototype),LocalStoragePro.prototype.constructor=LocalStoragePro,LocalStoragePro.prototype.length=0,LocalStoragePro.prototype.addDriver=function(a,b){const c=new b({window:this.window});!0===c.test()&&(this.drivers[a]=c,this.driver=this.drivers[a])},LocalStoragePro.prototype.setItem=function(a,b,c=null){if(!this.isKeyValid(a))return void this.emit("error",new Error("INVALID_KEY"));const d=this.getDriver(c);return d?(d.set(this.formatKey(a),b),utility.isError(d.error))?(this.emit("error",new Error("SET_ERROR"),d.error),void d.clearError()):(this.getLength(),!0):void 0},LocalStoragePro.prototype.getItem=function(a,b=null){if(!this.isKeyValid(a))return void this.emit("error",new Error("INVALID_KEY"));const c=this.getDriver(b);if(c){const b=c.get(this.formatKey(a));return this.getLength(),b}},LocalStoragePro.prototype.removeItem=function(a,b=null){if(!this.isKeyValid(a))return void this.emit("error",new Error("INVALID_KEY"));const c=this.getDriver(b);if(c)c.remove(this.formatKey(a)),this.getLength();else return;return!0},LocalStoragePro.prototype.clear=function(a=null){const b=this.getDriver(a);return b&&(b.clear(),this.getLength()),!0},LocalStoragePro.prototype.key=function(a=0,b=null){const c=this.getDriver(b);return c?c.getKey(a):null},LocalStoragePro.prototype.getLength=function(a=null){const b=this.getDriver(a);return this.length=b?b.length():0,this.length},LocalStoragePro.prototype.json=function(a=null){const b=this.getDriver(a);return b?b.json():0},LocalStoragePro.prototype.isKeyValid=function(a){return utility.isString(a)&&!utility.isEmpty(a)||utility.isNumber(a)},LocalStoragePro.prototype.formatKey=function(a){return utility.isNumber(a)?a.toString():a},LocalStoragePro.prototype.availableDrivers=function(){return Object.keys(this.drivers)},LocalStoragePro.prototype.getDriver=function(a=null){return utility.isEmpty(a)?this.driver:-1===this.availableDrivers().indexOf(a)?void this.emit("error",new Error("DRIVER_NOT_FOUND")):this.drivers[a]},module.exports=LocalStoragePro;