const kit=require("@basekits/core"),EventEmitter=require("event-emitter-object"),LocalStorageDriver=require("./drivers/localStorage"),MemoryDriver=require("./drivers/memory");function LocalStoragePro(a={}){EventEmitter.call(this,{}),this.kit=kit,this.kit.addKit(require("@basekits/kit-type")),this.kit.addKit(require("@basekits/kit-error")),this.kit.addKit(require("@basekits/kit-validator")),this.kit.addKit(require("@basekits/kit-object")),this.kit.addKit(require("@basekits/kit-function")),this.drivers={},this.driver=null,this.readWindow(a),this.addDriver("memory",MemoryDriver),this.addDriver("localStorage",LocalStorageDriver)}LocalStoragePro.prototype=Object.create(EventEmitter.prototype),LocalStoragePro.prototype.constructor=LocalStoragePro,LocalStoragePro.prototype.length=0,LocalStoragePro.prototype.readWindow=function(a){this.window=this.kit.getProp(a,"window","undefined"==typeof window?null:window)},LocalStoragePro.prototype.addDriver=function(a,b){const c=new b({window:this.window});!0===c.test()&&(this.drivers[a]=c,this.driver=this.drivers[a])},LocalStoragePro.prototype.setItem=function(a,b,c=null){if(!this.isKeyValid(a))return void this.emit("error",new Error("INVALID_KEY"));const d=this.getDriver(c);return d?(d.set(this.formatKey(a),b,this),this.kit.isError(d.error))?(this.emit("error",new Error("SET_ERROR"),d.error),void d.clearError()):(this.getLength(),!0):void 0},LocalStoragePro.prototype.getItem=function(a,b=null){if(!this.isKeyValid(a))return void this.emit("error",new Error("INVALID_KEY"));const c=this.getDriver(b);if(c){const b=c.get(this.formatKey(a),this);return this.getLength(),b}},LocalStoragePro.prototype.removeItem=function(a,b=null){if(!this.isKeyValid(a))return void this.emit("error",new Error("INVALID_KEY"));const c=this.getDriver(b);if(c)c.remove(this.formatKey(a)),this.getLength();else return;return!0},LocalStoragePro.prototype.clear=function(a=null){const b=this.getDriver(a);return b&&(b.clear(),this.getLength()),!0},LocalStoragePro.prototype.key=function(a=0,b=null){const c=this.getDriver(b);return c?c.getKey(a):null},LocalStoragePro.prototype.getLength=function(a=null){const b=this.getDriver(a);return this.length=b?b.length():0,this.length},LocalStoragePro.prototype.json=function(a=null){const b=this.getDriver(a);return b?b.json(this):0},LocalStoragePro.prototype.isKeyValid=function(a){return this.kit.isString(a)&&!this.kit.isEmpty(a)||this.kit.isNumber(a)},LocalStoragePro.prototype.formatKey=function(a){return this.kit.isNumber(a)?a.toString():a},LocalStoragePro.prototype.availableDrivers=function(){return Object.keys(this.drivers)},LocalStoragePro.prototype.getDriver=function(a=null){return this.kit.isEmpty(a)?this.driver:-1===this.availableDrivers().indexOf(a)?void this.emit("error",new Error("DRIVER_NOT_FOUND")):this.drivers[a]},module.exports=LocalStoragePro;